<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Account Modify</title>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M" crossorigin="anonymous">
    <link href="https://getbootstrap.com/docs/4.0/examples/signin/signin.css" rel="stylesheet" crossorigin="anonymous"/>
    <script th:src="@{https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js}"></script>
</head>
<body>
<form id="modAccount" method="post" action="/modify" enctype="multipart/form-data">
    <h1>회원정보 수정페이지</h1>
    <input type="hidden" name="memberId" id="memberId" th:value="${dto.memberId}">
    <input type="hidden" name="fromSocial" th:value="${dto.fromSocial}">

    <div class="form-group">
        <label>아이디</label><br>
        <input type="text" name="email" th:value="${dto?.email}" readonly/><br>
    </div>

    <div class="form-group">
        <label>비밀번호</label><br>
        <input type="password" name="password" id="password" onkeyup="passChk()" placeholder="비밀번호를 입력해주세요"/><br>
        <span id="password_basic" style="font-size:6px; color:blue; font-weight:bold; display:block;">미기입시 현재 비밀번호가 유지됩니다.</span>
        <span id="password_valid" style="color:red; display:none;">비밀번호는 8자 이상 20자 이하로 입력해주세요.</span>
        <span id="password_possible" style="color:green; display:none;">사용가능한 비밀번호 입니다.</span>
    </div>

    <div class="form-group">
        <label>닉네임</label><br>
        <input type="text" name="nickname" id="nickname" onkeyup="nickChk()" placeholder="닉네임을 입력해주세요"/><br>
        <span id="nickname_basic" style="font-size:6px; color:blue; font-weight:bold;">미기입시 현재 닉네임이 유지됩니다.</span>
        <span id="nickname_valid" style="color:red; display:none;">닉네임은 특수문자를 제외한 2~8자리여야 합니다.</span>
        <span id="nickname_possible" style="color:green; display:none;">사용가능한 닉네임 입니다.</span>
        <span id="nickname_impossible" style="color:red; display:none;">이미 사용중인 닉네임 입니다.</span>
    </div>

    <p>프로필사진: ajax로 업로드 된 사진 표시 </p>
    <input type="file" name="profileImgUrl">
    <p><button type="button" onclick="checkSubmit()">정보수정</button></p>

    <script>
        var submitPossible = true;

        function passChk(){
            var pass = document.getElementById('password');
            var basic = document.getElementById('password_basic');
            var valid = document.getElementById('password_valid');
            var possible = document.getElementById('password_possible');

            if(pass.value.length>0) {
                if(!(pass.value.length>7 && pass.value.length<21)) {
                    basic.style.display = 'none';
                    valid.style.display = 'block';
                    possible.style.display = 'none';
                    submitPossible = false;
                }else{
                    basic.style.display = 'none';
                    possible.style.display = 'block';
                    valid.style.display = 'none';
                    submitPossible = true;
                }
            }else{
                basic.style.display = 'block';
                valid.style.display = 'none';
                possible.style.display = 'none';
                submitPossible = true;
            }
        }

        function nickChk(){
            var nick = document.getElementById('nickname');
            var basic = document.getElementById('nickname_basic');
            var valid = document.getElementById('nickname_valid');
            var possible = document.getElementById('nickname_possible');
            var impossible = document.getElementById('nickname_impossible');

            if(nick.value.length>0) {
                if(!/^[가-힣a-z0-9-_]{2,8}$/.test(nick.value)) {
                    basic.style.display = 'none';
                    valid.style.display = 'block';
                    possible.style.display = 'none';
                    impossible.style.display = 'none';
                    submitPossible = false;
                }else{
                    $.ajax({
                        type : "post",
                        url : "/nickChk",
                        data : {"nickname":nickname.value},
                        contentType: "application/x-www-form-urlencoded; charset=UTF-8",
                        success : function(result){
                            if(result == "0"){
                                basic.style.display = 'none';
                                valid.style.display = 'none';
                                possible.style.display = 'block';
                                impossible.style.display = 'none';
                                submitPossible = true;
                            }else{
                                basic.style.display = 'none';
                                valid.style.display = 'none';
                                possible.style.display = 'none';
                                impossible.style.display = 'block';
                                submitPossible = false;
                            }
                        },
                        error : function(){
                            alert("ajax 실행 실패");
                        }
                    });
                }
            }else{
                basic.style.display = 'block';
                valid.style.display = 'none';
                possible.style.display = 'none';
                impossible.style.display = 'none';
                submitPossible = true;
            }
        }

        function checkSubmit(){
            if(submitPossible==false){
                alert("회원정보 수정에 실패하였습니다");
                return;
            }else{
                var modForm = document.getElementById('modAccount');
                modForm.submit();
            }
        }
    </script>
</form>
</body>
</html>